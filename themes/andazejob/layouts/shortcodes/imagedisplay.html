{{ $src := .Page.Resources.GetMatch (printf "*%s*" (.Get 0)) }}
{{ $type_arr := split $src "." }}
{{ $srcbase := index $type_arr 0 }}
{{ $webp := print $srcbase ".webp" }}
{{ $webpsrc := .Page.Resources.GetMatch (printf "*%s*" ($webp)) }}

{{ $Scratch := newScratch}}
{{ $Scratch.Set "size1" "" }}
{{ $Scratch.Set "size2" "" }}
{{ $Scratch.Set "size3" "" }}

{{if .Get 1 }}
  {{$get1:= .Get 1 }}
  {{ $Scratch.Set "size1" $get1 }}
{{ else }}
  {{ $getimg1:= .Site.Params.Imagesize1 }}
  {{ $Scratch.Set "size1" $getimg1 }}
{{ end }}

{{if .Get 2 }}
  {{$get2:= .Get 2 }}
  {{ $Scratch.Set "size2" $get2 }}
{{ else }}
  {{ $getimg2:= .Site.Params.Imagesize2 }}
  {{ $Scratch.Set "size2" $getimg2 }}
{{ end }}

{{if .Get 3 }}
  {{$get3:= .Get 3 }}
  {{ $Scratch.Set "size3" $get3 }}
{{ else }}
{{ $getimg3:= .Site.Params.Imagesize3 }}
{{ $Scratch.Set "size3" $getimg3 }}
{{ end }}

{{ $size1 := $Scratch.Get "size1" }}
{{ $size2 := $Scratch.Get "size2" }}
{{ $size3 := $Scratch.Get "size3" }}


{{ $smallw := printf "%s%s" $size1 "x" }}
{{ $mediumw := printf "%s%s" $size2 "x" }}
{{ $largew := printf "%s%s" $size3 "x" }}
 
{{ if eq (index $type_arr 1) ("webp") }}
  {{ $small := $src.Resize $smallw }}
  {{ $medium := $src.Resize $mediumw }}
  {{ $large := $src.Resize $largew }}
  <figure>
    <picture>
      <img srcset='
          {{ with $large.RelPermalink }}{{.}} 1024w{{ end }}
        {{ with $medium.RelPermalink }}, {{.}} 640w{{ end }}
        {{ with $small.RelPermalink }}, {{.}} 320w{{ end }}
      ' sizes="(max-width: 375px) $size1,
      (max-width: 768px) $size2,
      $size3"
      src="{{ `../../../../images/imageLoading.gif` }}" data-src="{{ $src.RelPermalink }}" class="lazyload" 
      />
    </picture>
  </figure>
{{ else }}
<figure>
  <picture>
  {{ $small := $src.Resize $smallw }}
  {{ $medium := $src.Resize $mediumw }}
  {{ $large := $src.Resize $largew }}
  {{ if $webpsrc }}
  {{ $smallwebp := $webpsrc.Resize $smallw }}
  {{ $mediumwebp := $webpsrc.Resize $mediumw }}
  {{ $largewebp := $webpsrc.Resize $largew }}
  <source srcset='
  {{ with $largewebp.RelPermalink }}{{.}} 1024w{{ end }}
  {{ with $mediumwebp.RelPermalink }}, {{.}} 640w{{ end }}
  {{ with $smallwebp.RelPermalink }}, {{.}} 320w{{ end }}
  ' sizes="(max-width: 375px) $size1,
  (max-width: 768px) $size2,
  $size3"> 
  {{ end }}

      <source srcset='
      {{ with $large.RelPermalink }}{{.}} 1024w{{ end }}
      {{ with $medium.RelPermalink }}, {{.}} 640w{{ end }}
      {{ with $small.RelPermalink }}, {{.}} 320w{{ end }}
      ' sizes="(max-width: 375px) $size1,
      (max-width: 768px) $size2,
      $size3">
      
            
      
      <img src="{{ `../../../../images/imageLoading.gif` }}" data-src="{{ $src.RelPermalink }}" class="lazyload" 
      />
    </picture>
  </figure>
{{ end }}
